<!DOCTYPE html>
<html>

<head>

<html xmlns="http://www.w3.org/1999/xhtml" lang="zh-cmn-Hans" xml:lang="zh-cmn-Hans">
<meta charset="utf-8">
<meta name="X-UA-Compatible" content="IE=edge">
<meta name="content-language" content="zh">
<meta name="Content-Security-Policy" content="">
<meta name="viewport" content="width=device-width initial-scale=1">

<title>SQL Server截取字符串和处理中文技巧</title>
<meta name="description" content="目录">
<meta name="keywords" content="MySQL, Linux, Python, Reading, DBA, Muisc, 阅读, 音乐, 钢琴, 文学">
<meta property="og:title" content="DBA@Robin, MySQL DBA" />
<meta property="og:type" content="Blog, Focus on Database." />
<meta property="og:url" content="http://dbarobin.com/" />
<meta property="og:image" content="http://dbarobin.com/images/wentasy.png" />

<meta name="twitter:card" content="summary">
<meta name="twitter:site" content="@dbarobin">
<meta name="twitter:creator" content="@dbarobin">
<meta name="twitter:title" content="SQL Server截取字符串和处理中文技巧">
<meta name="twitter:description" content="目录">
<meta name="twitter:url" content="http://dbarobin.com/2014/04/26/skill-of-intercepting-string-and-processing-chinese-character-in-mssql/">

<link rel="icon" href="/images/favicon.ico">
<link rel="stylesheet" href="/css/main.css">
<link rel="stylesheet" href="/assets/awesome/css/font-awesome.min.css">
<link rel="stylesheet" type="text/css" href="/assets/css/robin.css">
<link rel="stylesheet" type="text/css" href="/assets/css/fonts-open-sans.css">
<link rel="canonical" href="http://dbarobin.com/2014/04/26/skill-of-intercepting-string-and-processing-chinese-character-in-mssql/">
<link rel="alternate" type="application/atom+xml" title="DBA@Robin" href="http://dbarobin.com/feed.xml" />

<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?385d238b95fb1e2bd25f6510cc28b7a9";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>
<noscript>Your browser doesn't support JavaScript or you have disabled JavaScript!</noscript>

</head>


<body>

<div class="container">

  <header class="site-header">

  <div class="wrapper">

    <h1 class="site-title"><a href="/">DBA@Robin</a></h1>
    <h3 class="site-meta">Focus on database.</h3>

    <nav class="site-nav">
      <a href="#" class="menu-icon">
        <svg viewBox="0 0 18 15">
          <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </a>
      <div class="trigger">
        
        
        <a class="page-link" href="/">Home</a>
        
        
        
        <a class="page-link" href="/about/">About</a>
        
        
        
        <a class="page-link" href="/categories/">Categories</a>
        
        
        
        <a class="page-link" href="/archives/">Archives</a>
        
        
        
        <a class="page-link" href="/tags/">Tags</a>
        
        
        
        <a class="page-link" href="/guestbook/">GuestBook</a>
        
        
        
        <a class="page-link" href="/feed.xml">Subscribe</a>
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
      </div>
    </nav>

  </div>

</header>


    

  <div class="page-content col-sm-8">
    <div class="post" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 itemprop="name" class="post-title">SQL Server截取字符串和处理中文技巧</h1>
    <meta itemprop="keywords" content="Database,数据库,MSSQL,SQL Server,技巧,分享,截取字符串,处理中文" />
    <p class="post-meta">
    Posted in
    
    <a href="/categories/#other">Other</a>&nbsp;
     
    
    and tagged
    
    <a href="/tags/#Database" title="Database">Database </a>, 
    
    <a href="/tags/#数据库" title="数据库">数据库 </a>, 
    
    <a href="/tags/#MSSQL" title="MSSQL">MSSQL </a>, 
    
    <a href="/tags/#SQL Server" title="SQL Server">SQL Server </a>, 
    
    <a href="/tags/#技巧" title="技巧">技巧 </a>, 
    
    <a href="/tags/#分享" title="分享">分享 </a>, 
    
    <a href="/tags/#截取字符串" title="截取字符串">截取字符串 </a>, 
    
    <a href="/tags/#处理中文" title="处理中文">处理中文 </a>
    
    
    on Apr 26, 2014. 
    <span id="container_page_counter">
      Viewd <span id="value_page_counter"></span> times.
    </span>
    </p>
  </header>

  <article class="post-content" itemprop="articleBody">
    <h2 id="section">目录</h2>

<ul id="markdown-toc">
  <li><a href="#section" id="markdown-toc-section">目录</a></li>
  <li><a href="#section-1" id="markdown-toc-section-1">一 环境介绍</a></li>
  <li><a href="#section-2" id="markdown-toc-section-2">二 实现功能</a></li>
  <li><a href="#section-3" id="markdown-toc-section-3">三 实现模拟</a></li>
  <li><a href="#section-4" id="markdown-toc-section-4">四 总结</a></li>
</ul>

<p><code>文/温国兵</code></p>

<h2 id="section-1">一 环境介绍</h2>

<p><strong>SQL  Server</strong></p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">PRINT @@VERSION
MicrosoftSQLServer2012-11.0.2100.60<span class="o">(</span>X64<span class="o">)</span>
Feb10201219:39:15
Copyright<span class="o">(</span>c<span class="o">)</span>MicrosoftCorporation
EnterpriseEdition:Core-basedLicensing<span class="o">(</span>64-bit<span class="o">)</span>onWindowsNT6.1<span class="o">(</span>Build7601:ServicePack1<span class="o">)</span></code></pre></div>

<p><strong>操作系统</strong></p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">------------------
System Information
------------------
Operating System: Windows <span class="m">7</span> Ultimate 64-bit <span class="o">(</span>6.1, Build 7601<span class="o">)</span> <span class="se">\</span>
Service Pack <span class="m">1</span> <span class="o">(</span>7601.win7sp1_gdr.130828-1532<span class="o">)</span>
System Model: Aspire E1-471G
Processor: Intel<span class="o">(</span>R<span class="o">)</span> Core<span class="o">(</span>TM<span class="o">)</span> i5-3230M CPU @ 2.60GHz <span class="o">(</span><span class="m">4</span> CPUs<span class="o">)</span>, ~2.6GHz
Memory: 4096MB RAM</code></pre></div>

<h2 id="section-2">二 实现功能</h2>

<p>从一大堆有包含中文字符和编号的字符串中过滤出编号。</p>

<h2 id="section-3">三 实现模拟</h2>

<p>首先，我们准备测试数据，注意，这里的数据全部都是模拟数据，无实际含义。语句如下：</p>

<div class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="o">#</span><span class="n">temp</span>
<span class="p">(</span>
   <span class="n">name</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">80</span><span class="p">)</span>
<span class="p">);</span>

<span class="k">INSERT</span> <span class="k">INTO</span> <span class="o">#</span><span class="n">temp</span>
<span class="k">VALUES</span>     <span class="p">(</span><span class="s1">&#39;五道口店3059&#39;</span><span class="p">);</span>

<span class="k">INSERT</span> <span class="k">INTO</span> <span class="o">#</span><span class="n">temp</span>
<span class="k">VALUES</span>     <span class="p">(</span><span class="s1">&#39;五羊邨店3060&#39;</span><span class="p">);</span>

<span class="k">INSERT</span> <span class="k">INTO</span> <span class="o">#</span><span class="n">temp</span>
<span class="k">VALUES</span>     <span class="p">(</span><span class="s1">&#39;杨家屯店3061&#39;</span><span class="p">);</span>

<span class="k">INSERT</span> <span class="k">INTO</span> <span class="o">#</span><span class="n">temp</span>
<span class="k">VALUES</span>     <span class="p">(</span><span class="s1">&#39;十里堤店3062&#39;</span><span class="p">);</span>

<span class="k">INSERT</span> <span class="k">INTO</span> <span class="o">#</span><span class="n">temp</span>
<span class="k">VALUES</span>     <span class="p">(</span><span class="s1">&#39;中关村店3063&#39;</span><span class="p">);</span>

<span class="k">INSERT</span> <span class="k">INTO</span> <span class="o">#</span><span class="n">temp</span>
<span class="k">VALUES</span>     <span class="p">(</span><span class="s1">&#39;丽秀店3064&#39;</span><span class="p">);</span>

<span class="k">INSERT</span> <span class="k">INTO</span> <span class="o">#</span><span class="n">temp</span>
<span class="k">VALUES</span>     <span class="p">(</span><span class="s1">&#39;石门店3065&#39;</span><span class="p">);</span>

<span class="k">INSERT</span> <span class="k">INTO</span> <span class="o">#</span><span class="n">temp</span>
<span class="k">VALUES</span>     <span class="p">(</span><span class="s1">&#39;黄村店3066&#39;</span><span class="p">);</span>

<span class="k">INSERT</span> <span class="k">INTO</span> <span class="o">#</span><span class="n">temp</span>
<span class="k">VALUES</span>     <span class="p">(</span><span class="s1">&#39;东圃店3067&#39;</span><span class="p">);</span>

<span class="k">INSERT</span> <span class="k">INTO</span> <span class="o">#</span><span class="n">temp</span>
<span class="k">VALUES</span>     <span class="p">(</span><span class="s1">&#39;天河店3068&#39;</span><span class="p">);</span>

<span class="k">INSERT</span> <span class="k">INTO</span> <span class="o">#</span><span class="n">temp</span>
<span class="k">VALUES</span>     <span class="p">(</span><span class="s1">&#39;人民路广场3069&#39;</span><span class="p">);</span>

<span class="k">INSERT</span> <span class="k">INTO</span> <span class="o">#</span><span class="n">temp</span>
<span class="k">VALUES</span>     <span class="p">(</span><span class="s1">&#39;社区中心3070&#39;</span><span class="p">);</span>

<span class="k">INSERT</span> <span class="k">INTO</span> <span class="o">#</span><span class="n">temp</span>
<span class="k">VALUES</span>     <span class="p">(</span><span class="s1">&#39;珠海市3071&#39;</span><span class="p">);</span>

<span class="k">INSERT</span> <span class="k">INTO</span> <span class="o">#</span><span class="n">temp</span>
<span class="k">VALUES</span>     <span class="p">(</span><span class="s1">&#39;丽都3072&#39;</span><span class="p">);</span>

<span class="k">INSERT</span> <span class="k">INTO</span> <span class="o">#</span><span class="n">temp</span>
<span class="k">VALUES</span>     <span class="p">(</span><span class="s1">&#39;晓月3073&#39;</span><span class="p">);</span>

<span class="k">INSERT</span> <span class="k">INTO</span> <span class="o">#</span><span class="n">temp</span>
<span class="k">VALUES</span>     <span class="p">(</span><span class="s1">&#39;旧区3074&#39;</span><span class="p">);</span>

<span class="k">INSERT</span> <span class="k">INTO</span> <span class="o">#</span><span class="n">temp</span>
<span class="k">VALUES</span>     <span class="p">(</span><span class="s1">&#39;新城3075&#39;</span><span class="p">);</span>

<span class="k">INSERT</span> <span class="k">INTO</span> <span class="o">#</span><span class="n">temp</span>
<span class="k">VALUES</span>     <span class="p">(</span><span class="s1">&#39;水井沟3076&#39;</span><span class="p">);</span></code></pre></div>

<p>然后，我们观察数据，发现这些数据都有规律，编号是数字，占4个字符。数字前面包含店、场、心、市、都、月、区、城、沟共9个字符。<br />
我们试着采用SQL Server内置的函数Substring、Charindex、Rtrim、Ltrim过滤掉出现次数最多（店）的字符串。<br />
语句如下：</p>

<div class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="k">SELECT</span> <span class="n">Rtrim</span><span class="p">(</span><span class="n">Ltrim</span><span class="p">(</span><span class="k">Substring</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">Charindex</span><span class="p">(</span><span class="s1">&#39;店&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Len</span><span class="p">(</span><span class="n">name</span><span class="p">))))</span> <span class="k">AS</span> <span class="n">name</span>
<span class="k">INTO</span>   <span class="o">#</span><span class="n">t1</span>
<span class="k">FROM</span>   <span class="o">#</span><span class="n">temp</span></code></pre></div>

<p>以下是这几个函数的使用说明：</p>

<p><strong>Substring</strong></p>

<blockquote>
  <p><strong>Returns the part of a character expression that starts at the specified position and has the specified length. The position parameter and the length parameter must evaluate to integers.</strong></p>

  <p><strong>Syntax</strong><br />
SUBSTRING(character_expression, position, length)</p>

  <p><strong>Arguments</strong><br />
character_expression<br />
Is a character expression from which to extract characters.<br />
position<br />
Is an integer that specifies where the substring begins.<br />
length<br />
Is an integer that specifies the length of the substring as number of characters.</p>

  <p><strong>Result Types</strong><br />
DT_WSTR</p>
</blockquote>

<p><strong>Charindex</strong></p>

<blockquote>
  <p><strong>Searches an expression for anOther expression and returns its starting position if found.</strong></p>

  <p><strong>Syntax</strong><br />
CHARINDEX ( expressionToFind ,expressionToSearch [ , start_location ] )</p>

  <p><strong>Arguments</strong><br />
expressionToFind<br />
Is a character expression that contains the sequence to be found. expressionToFind is limited to 8000 characters.<br />
expressionToSearch<br />
Is a character expression to be searched.<br />
start_location<br />
Is an integer or bigint expression at which the search starts. If start_location is not specified, is a negative number, or is 0, the search starts at the beginning of expressionToSearch.</p>

  <p><strong>Return Types</strong><br />
bigint if expressionToSearch is of the varchar(max), nvarchar(max), or varbinary(max) data types; Otherwise, int.</p>
</blockquote>

<p><strong>Rtrim</strong></p>

<blockquote>
  <p><strong>Returns a character expression after removing trailing spaces.</strong></p>

  <p>RTRIM does not remove white space characters such as the tab or line feed characters. Unicode provides code points for many different types of spaces, but this function recognizes only the Unicode code point 0x0020. When double-byte character set (DBCS) strings are converted to Unicode they may include space characters Other than 0x0020 and the function cannot remove such spaces. To remove all kinds of spaces, you can use the Microsoft Visual Basic .NET RTrim method in a script run from the Script component.</p>

  <p><strong>Syntax</strong><br />
RTRIM(character expression)</p>

  <p><strong>Arguments</strong><br />
character_expression<br />
Is a character expression from which to remove spaces.</p>

  <p><strong>Result Types</strong><br />
DT_WSTR</p>
</blockquote>

<p><strong>Ltrim</strong></p>

<blockquote>
  <p><strong>Returns a character expression after removing leading spaces.</strong></p>

  <p>LTRIM does not remove white-space characters such as the tab or line feed characters. Unicode provides code points for many different types of spaces, but this function recognizes only the Unicode code point 0x0020. When double-byte character set (DBCS) strings are converted to Unicode they may include space characters Other than 0x0020 and the function cannot remove such spaces. To remove all kinds of spaces, you can use the Microsoft Visual Basic .NET LTrim method in a script run from the Script component.</p>

  <p><strong>Syntax</strong><br />
LTRIM(character expression)</p>

  <p><strong>Arguments</strong><br />
character_expression<br />
Is a character expression from which to remove spaces.</p>

  <p><strong>Result Types</strong><br />
DT_WSTR</p>
</blockquote>

<p>好了，我们查看处理完后的结果，可以看到包含店的字符串已经全部过滤出编号。</p>

<div class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="o">#</span><span class="n">t1</span>
<span class="mi">3059</span>
<span class="mi">3060</span>
<span class="mi">3061</span>
<span class="mi">3062</span>
<span class="mi">3063</span>
<span class="mi">3064</span>
<span class="mi">3065</span>
<span class="mi">3066</span>
<span class="mi">3067</span>
<span class="mi">3068</span>
<span class="err">人民路广场</span><span class="mi">3069</span>
<span class="err">社区中心</span><span class="mi">3070</span>
<span class="err">珠海市</span><span class="mi">3071</span>
<span class="err">丽都</span><span class="mi">3072</span>
<span class="err">晓月</span><span class="mi">3073</span>
<span class="err">旧区</span><span class="mi">3074</span>
<span class="err">新城</span><span class="mi">3075</span>
<span class="err">水井沟</span><span class="mi">3076</span></code></pre></div>

<p>接着我们依次处理包含场、心、市、都、月、区、城、沟的字符串，语句和处理结果如下：</p>

<div class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="k">SELECT</span> <span class="o">*</span>
<span class="k">FROM</span>   <span class="o">#</span><span class="n">t1</span>
<span class="k">WHERE</span>  <span class="n">name</span> <span class="k">LIKE</span> <span class="n">N</span><span class="s1">&#39;%[一-龥]%&#39;</span> <span class="k">COLLATE</span> <span class="n">Chinese_PRC_BIN</span>
<span class="err">人民路广场</span><span class="mi">3069</span>
<span class="err">社区中心</span><span class="mi">3070</span>
<span class="err">珠海市</span><span class="mi">3071</span>
<span class="err">丽都</span><span class="mi">3072</span>
<span class="err">晓月</span><span class="mi">3073</span>
<span class="err">旧区</span><span class="mi">3074</span>
<span class="err">新城</span><span class="mi">3075</span>
<span class="err">水井沟</span><span class="mi">3076</span>

<span class="k">SELECT</span> <span class="n">Rtrim</span><span class="p">(</span><span class="n">Ltrim</span><span class="p">(</span><span class="k">Substring</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">Charindex</span><span class="p">(</span><span class="s1">&#39;场&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Len</span><span class="p">(</span><span class="n">name</span><span class="p">))))</span> <span class="k">AS</span> <span class="n">name</span>
<span class="k">INTO</span>   <span class="o">#</span><span class="n">t2</span>
<span class="k">FROM</span>   <span class="o">#</span><span class="n">t1</span>
<span class="k">SELECT</span> <span class="o">*</span>
<span class="k">FROM</span>   <span class="o">#</span><span class="n">t2</span>
<span class="k">WHERE</span>  <span class="n">name</span> <span class="k">LIKE</span> <span class="n">N</span><span class="s1">&#39;%[一-龥]%&#39;</span> <span class="k">COLLATE</span> <span class="n">Chinese_PRC_BIN</span>
<span class="err">社区中心</span><span class="mi">3070</span>
<span class="err">珠海市</span><span class="mi">3071</span>
<span class="err">丽都</span><span class="mi">3072</span>
<span class="err">晓月</span><span class="mi">3073</span>
<span class="err">旧区</span><span class="mi">3074</span>
<span class="err">新城</span><span class="mi">3075</span>
<span class="err">水井沟</span><span class="mi">3076</span>

<span class="k">SELECT</span> <span class="n">Rtrim</span><span class="p">(</span><span class="n">Ltrim</span><span class="p">(</span><span class="k">Substring</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">Charindex</span><span class="p">(</span><span class="s1">&#39;心&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Len</span><span class="p">(</span><span class="n">name</span><span class="p">))))</span> <span class="k">AS</span> <span class="n">name</span>
<span class="k">INTO</span>   <span class="o">#</span><span class="n">t3</span>
<span class="k">FROM</span>   <span class="o">#</span><span class="n">t2</span>
<span class="k">SELECT</span> <span class="o">*</span>
<span class="k">FROM</span>   <span class="o">#</span><span class="n">t3</span>
<span class="k">WHERE</span>  <span class="n">name</span> <span class="k">LIKE</span> <span class="n">N</span><span class="s1">&#39;%[一-龥]%&#39;</span> <span class="k">COLLATE</span> <span class="n">Chinese_PRC_BIN</span>
<span class="err">珠海市</span><span class="mi">3071</span>
<span class="err">丽都</span><span class="mi">3072</span>
<span class="err">晓月</span><span class="mi">3073</span>
<span class="err">旧区</span><span class="mi">3074</span>
<span class="err">新城</span><span class="mi">3075</span>
<span class="err">水井沟</span><span class="mi">3076</span>

<span class="k">SELECT</span> <span class="n">Rtrim</span><span class="p">(</span><span class="n">Ltrim</span><span class="p">(</span><span class="k">Substring</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">Charindex</span><span class="p">(</span><span class="s1">&#39;市&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Len</span><span class="p">(</span><span class="n">name</span><span class="p">))))</span> <span class="k">AS</span> <span class="n">name</span>
<span class="k">INTO</span>   <span class="o">#</span><span class="n">t4</span>
<span class="k">FROM</span>   <span class="o">#</span><span class="n">t3</span>
<span class="k">SELECT</span> <span class="o">*</span>
<span class="k">FROM</span>   <span class="o">#</span><span class="n">t4</span>
<span class="k">WHERE</span>  <span class="n">name</span> <span class="k">LIKE</span> <span class="n">N</span><span class="s1">&#39;%[一-龥]%&#39;</span> <span class="k">COLLATE</span> <span class="n">Chinese_PRC_BIN</span>
<span class="err">丽都</span><span class="mi">3072</span>
<span class="err">晓月</span><span class="mi">3073</span>
<span class="err">旧区</span><span class="mi">3074</span>
<span class="err">新城</span><span class="mi">3075</span>
<span class="err">水井沟</span><span class="mi">3076</span>

<span class="k">SELECT</span> <span class="n">Rtrim</span><span class="p">(</span><span class="n">Ltrim</span><span class="p">(</span><span class="k">Substring</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">Charindex</span><span class="p">(</span><span class="s1">&#39;都&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Len</span><span class="p">(</span><span class="n">name</span><span class="p">))))</span> <span class="k">AS</span> <span class="n">name</span>
<span class="k">INTO</span>   <span class="o">#</span><span class="n">t5</span>
<span class="k">FROM</span>   <span class="o">#</span><span class="n">t4</span>
<span class="k">SELECT</span> <span class="o">*</span>
<span class="k">FROM</span>   <span class="o">#</span><span class="n">t5</span>
<span class="k">WHERE</span>  <span class="n">name</span> <span class="k">LIKE</span> <span class="n">N</span><span class="s1">&#39;%[一-龥]%&#39;</span> <span class="k">COLLATE</span> <span class="n">Chinese_PRC_BIN</span>
<span class="err">晓月</span><span class="mi">3073</span>
<span class="err">旧区</span><span class="mi">3074</span>
<span class="err">新城</span><span class="mi">3075</span>
<span class="err">水井沟</span><span class="mi">3076</span>


<span class="k">SELECT</span> <span class="n">Rtrim</span><span class="p">(</span><span class="n">Ltrim</span><span class="p">(</span><span class="k">Substring</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">Charindex</span><span class="p">(</span><span class="s1">&#39;月&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Len</span><span class="p">(</span><span class="n">name</span><span class="p">))))</span> <span class="k">AS</span> <span class="n">name</span>
<span class="k">INTO</span>   <span class="o">#</span><span class="n">t6</span>
<span class="k">FROM</span>   <span class="o">#</span><span class="n">t5</span>
<span class="k">SELECT</span> <span class="o">*</span>
<span class="k">FROM</span>   <span class="o">#</span><span class="n">t6</span>
<span class="k">WHERE</span>  <span class="n">name</span> <span class="k">LIKE</span> <span class="n">N</span><span class="s1">&#39;%[一-龥]%&#39;</span> <span class="k">COLLATE</span> <span class="n">Chinese_PRC_BIN</span>
<span class="err">旧区</span><span class="mi">3074</span>
<span class="err">新城</span><span class="mi">3075</span>
<span class="err">水井沟</span><span class="mi">3076</span>

<span class="k">SELECT</span> <span class="n">Rtrim</span><span class="p">(</span><span class="n">Ltrim</span><span class="p">(</span><span class="k">Substring</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">Charindex</span><span class="p">(</span><span class="s1">&#39;区&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Len</span><span class="p">(</span><span class="n">name</span><span class="p">))))</span> <span class="k">AS</span> <span class="n">name</span>
<span class="k">INTO</span>   <span class="o">#</span><span class="n">t7</span>
<span class="k">FROM</span>   <span class="o">#</span><span class="n">t6</span>
<span class="k">SELECT</span> <span class="o">*</span>
<span class="k">FROM</span>   <span class="o">#</span><span class="n">t7</span>
<span class="k">WHERE</span>  <span class="n">name</span> <span class="k">LIKE</span> <span class="n">N</span><span class="s1">&#39;%[一-龥]%&#39;</span> <span class="k">COLLATE</span> <span class="n">Chinese_PRC_BIN</span>
<span class="err">新城</span><span class="mi">3075</span>
<span class="err">水井沟</span><span class="mi">3076</span>

<span class="k">SELECT</span> <span class="n">Rtrim</span><span class="p">(</span><span class="n">Ltrim</span><span class="p">(</span><span class="k">Substring</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">Charindex</span><span class="p">(</span><span class="s1">&#39;城&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Len</span><span class="p">(</span><span class="n">name</span><span class="p">))))</span> <span class="k">AS</span> <span class="n">name</span>
<span class="k">INTO</span>   <span class="o">#</span><span class="n">t8</span>
<span class="k">FROM</span>   <span class="o">#</span><span class="n">t7</span>
<span class="k">SELECT</span> <span class="o">*</span>
<span class="k">FROM</span>   <span class="o">#</span><span class="n">t8</span>
<span class="k">WHERE</span>  <span class="n">name</span> <span class="k">LIKE</span> <span class="n">N</span><span class="s1">&#39;%[一-龥]%&#39;</span> <span class="k">COLLATE</span> <span class="n">Chinese_PRC_BIN</span>
<span class="err">水井沟</span><span class="mi">3076</span>

<span class="k">SELECT</span> <span class="n">Rtrim</span><span class="p">(</span><span class="n">Ltrim</span><span class="p">(</span><span class="k">Substring</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">Charindex</span><span class="p">(</span><span class="s1">&#39;沟&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Len</span><span class="p">(</span><span class="n">name</span><span class="p">))))</span> <span class="k">AS</span> <span class="n">name</span>
<span class="k">INTO</span>   <span class="o">#</span><span class="n">t9</span>
<span class="k">FROM</span>   <span class="o">#</span><span class="n">t8</span>
<span class="k">SELECT</span> <span class="o">*</span>
<span class="k">FROM</span>   <span class="o">#</span><span class="n">t9</span>
<span class="k">WHERE</span>  <span class="n">name</span> <span class="k">LIKE</span> <span class="n">N</span><span class="s1">&#39;%[一-龥]%&#39;</span> <span class="k">COLLATE</span> <span class="n">Chinese_PRC_BIN</span>
<span class="c1">--无记录</span></code></pre></div>

<p>这是最终的处理结果，过滤出编号后，我就可以利用这些编号和数据库表进行关联，获得想要的数据。</p>

<div class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="k">SELECT</span> <span class="o">*</span>
<span class="k">INTO</span>   <span class="o">#</span><span class="k">result</span>
<span class="k">FROM</span>   <span class="o">#</span><span class="n">t9</span>
<span class="k">SELECT</span> <span class="o">*</span>
<span class="k">FROM</span>   <span class="o">#</span><span class="k">result</span>
<span class="n">name</span>
<span class="mi">3059</span>
<span class="mi">3060</span>
<span class="mi">3061</span>
<span class="mi">3062</span>
<span class="mi">3063</span>
<span class="mi">3064</span>
<span class="mi">3065</span>
<span class="mi">3066</span>
<span class="mi">3067</span>
<span class="mi">3068</span>
<span class="mi">3069</span>
<span class="mi">3070</span>
<span class="mi">3071</span>
<span class="mi">3072</span>
<span class="mi">3073</span>
<span class="mi">3074</span>
<span class="mi">3075</span>
<span class="mi">3076</span>

<span class="k">SELECT</span> <span class="n">s</span><span class="p">.</span><span class="n">xxx</span><span class="p">,</span>
       <span class="n">s</span><span class="p">.</span><span class="n">xxx</span>
<span class="k">FROM</span>   <span class="n">xx</span> <span class="n">s</span>
       <span class="k">JOIN</span> <span class="o">#</span><span class="k">result</span> <span class="n">r</span>
         <span class="k">ON</span> <span class="n">s</span><span class="p">.</span><span class="n">xxx</span> <span class="o">=</span> <span class="n">r</span><span class="p">.</span><span class="n">name</span>
<span class="k">WHERE</span>  <span class="n">s</span><span class="p">.</span><span class="n">xxx</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span></code></pre></div>

<h2 id="section-4">四 总结</h2>

<p>本文过滤编号实际上核心代码就两个，第一个是利用SQL Server的内置函数过滤出指定编号，语句如下：</p>

<div class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="k">SELECT</span> <span class="n">Rtrim</span><span class="p">(</span><span class="n">Ltrim</span><span class="p">(</span><span class="k">Substring</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">Charindex</span><span class="p">(</span><span class="s1">&#39;店&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Len</span><span class="p">(</span><span class="n">name</span><span class="p">))))</span> <span class="k">AS</span> <span class="n">name</span>
<span class="k">INTO</span>   <span class="o">#</span><span class="n">t1</span>
<span class="k">FROM</span>   <span class="o">#</span><span class="n">temp</span></code></pre></div>

<p>第二个是判断是否包含中文，语句如下：</p>

<div class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="k">SELECT</span> <span class="o">*</span>
<span class="k">FROM</span>   <span class="o">#</span><span class="n">t1</span>
<span class="k">WHERE</span>  <span class="n">name</span> <span class="k">LIKE</span> <span class="n">N</span><span class="s1">&#39;%[一-龥]%&#39;</span> <span class="k">COLLATE</span> <span class="n">Chinese_PRC_BIN</span></code></pre></div>

<p><strong>在工作中，发现和总结这些小技巧会让你的工作事半功倍。</strong></p>

<p>–EOF–</p>

<p>原文地址：<a href="http://blog.csdn.net/justdb/article/details/24516997" target="_blank"><img src="http://i.imgur.com/BROigUO.jpg" title="SQL Server截取字符串和处理中文技巧" height="16px" width="16px" border="0" alt="SQL Server截取字符串和处理中文技巧" /></a></p>

<p>题图来自：原创，By <a href="http://dbarobin.com/" target="_blank">Robin Wen</a></p>

<p>版权声明：自由转载-非商用-非衍生-保持署名<a href="http://creativecommons.org/licenses/by-nc-nd/3.0/deed.zh" target="_blank">（创意共享3.0许可证）</a></p>

  </article>
  <hr />

</div>


<section class="pager">
  <ul>
    
    <li class="previous"><a href="/2014/04/26/import-data-to-mssql-fast/" title="SQL Server快速导入数据分享">&larr; Older</a></li>
    
    
    <li class="next"><a href="/2014/04/27/the-essence-of-big-data-appliance/" title="大数据一体机的实质">Newer &rarr;</a></li>
    
  </ul>
</section>

<div id="disqus_thread"></div>

<script type="text/javascript">

  var disqus_developer = 1;

var disqus_shortname ='dbarobin';
/* * * DON'T EDIT BELOW THIS LINE * * */
(function() {
  var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
  dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>

<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>



    <section class="pager">
  
  
</section>


  </div>
  <div class="col-sm-2">
<div class="sidebar-module about">
  <h4>About Me</h4>
  <img title="Robin Wen" src="/images/wentasy.png" alt="Robin Wen"/>

  <span>Robin Wen, MySQL DBA.</span>
  <br />

  WeChat: dbtalk
  <br />

  

  You can contact me via:

  
  <a href="mailto:dbarobinwen@gmail.com" title="mailto: dbarobinwen@gmail.com" target="_blank">Email</a> /
  
  
  <a href="https://github.com/dbarobin" title="GithubID: dbarobin" target="_blank">GitHub</a> /
  
  
  <a href="https://twitter.com/dbarobin" title="TwitterID: dbarobin" target="_blank">Twitter</a>
  

  

</div>

<div class="sidebar-module"> <!-- sidebar-module-inset">-->
  <h4>Copyright Notice</h4>

  

  <a href="http://creativecommons.org/licenses/by-nc-nd/3.0/">
    <img alt="Copyright Notice" src="http://i.creativecommons.org/l/by-nc-nd/3.0/88x31.png">
  </a>
  <br />
  <a href="http://creativecommons.org/licenses/by-nc-nd/3.0/">Attribution-NonCommercial-NoDerivs</a>

  

</div>

<div class="sidebar-module">
  <h4>Recent Posts</h4>
  
  <li>
  <a href="http://dbarobin.com/2015/04/07/mydumper/" title="mydumper 完全参考手册" rel="bookmark">mydumper 完全参考手册</a>
  </li>
  
  <li>
  <a href="http://dbarobin.com/2015/03/23/opensource-innovation-meetup-in-shenzhen/" title="开源中国深圳源创会分享" rel="bookmark">开源中国深圳源创会分享</a>
  </li>
  
  <li>
  <a href="http://dbarobin.com/2015/03/16/the-first-diary-of-website-optimization/" title="网站优化日记（一）" rel="bookmark">网站优化日记（一）</a>
  </li>
  
  <li>
  <a href="http://dbarobin.com/2015/03/08/lucky-money-of-wechat-and-alipay/" title="我看微信红包和支付宝红包" rel="bookmark">我看微信红包和支付宝红包</a>
  </li>
  
  <li>
  <a href="http://dbarobin.com/2015/02/28/sql-query-once-and-ten-times/" title="MySQL 每次查询一条数据查询十次与一次查询十条数据之间的区别" rel="bookmark">MySQL 每次查询一条数据查询十次与一次查询十条数据之间的区别</a>
  </li>
  
</div>

<div class="sidebar-module">
  <h4>Categories</h4>
  
  <li><a href="/categories/#other" title="other" rel="92">Other (92)</a></li>
  
  <li><a href="/categories/#linux" title="linux" rel="3">Linux (3)</a></li>
  
  <li><a href="/categories/#mysql" title="mysql" rel="28">Mysql (28)</a></li>
  
  <li><a href="/categories/#python" title="python" rel="2">Python (2)</a></li>
  
</div>


<div class="sidebar-module">
  <h4>Blogroll</h4>
  
  <li><a href="http://blog.csdn.net/dba_waterbin" title="DBA@DevOps" target="_blank">DBA@DevOps</a></li>
  
</div>


<div class="sidebar-module">
  <h4>Archives</h4>

  
  
  
  
  
  <li id="2015" > <a href="/archives/#2015">2015</a></li>
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  <li id="2014" > <a href="/archives/#2014">2014</a></li>
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  <li id="2013" > <a href="/archives/#2013">2013</a></li>
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  <li id="2012" > <a href="/archives/#2012">2012</a></li>
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  

</div>


</div>


  

  <footer class="site-footer">
  <link rel="stylesheet" type="text/css" href="/assets/css/robin.css">
  <p> &copy; 2015 Robin Wen. All Rights Reserved.</p>
   <div id="totop" class="mytotop">
      <a title="Back To Top"><img alt="Scrollup to home page of dbarobin.com" src="/images/scrollup.png"/></a>
   </div>

<script type="text/javascript" defer="defer" src="/assets/js/vendor/jquery-1.9.1.min.js"></script>
<script type="text/javascript" defer="defer" src="//dn-lbstatics.qbox.me/lbservice/busuanzi/1.0/busuanzi.mini.js"/></script>
<script type="text/javascript" defer="defer" src="/assets/js/totop.js"></script>
</footer>


</div>

</body>

</html>
